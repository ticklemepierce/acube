const SVG = `
<svg id="svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 800 500">
<style type="text/css"><![CDATA[.sticker { stroke: #000000; stroke-width: 1px; }]]></style>
<g><title>F</title>
<polygon id="CORNERS-l4-o1" class="sticker" style="fill: #00ff00" points="393.59999999999997 323.6 344.5333333333333 323.6 344.5333333333333 274.5333333333333 393.59999999999997 274.5333333333333"/>
<polygon id="EDGES-l8-o0" class="sticker" style="fill: #00ff00" points="344.5333333333333 274.5333333333333 344.5333333333333 225.4666666666667 393.59999999999997 225.4666666666667 393.59999999999997 274.5333333333333"/>
<polygon id="EDGES-l4-o1" class="sticker" style="fill: #00ff00" points="295.4666666666667 274.5333333333333 344.5333333333333 274.5333333333333 344.5333333333333 323.6 295.4666666666667 323.6"/>
<polygon id="CENTERS-l2-o0" class="sticker" style="fill: #00ff00" points="344.5333333333333 225.4666666666667 344.5333333333333 274.5333333333333 295.4666666666667 274.5333333333333 295.4666666666667 225.4666666666667"/>
<polygon id="CENTERS-l2-o1" class="sticker" style="fill: #00ff00" points="344.5333333333333 225.4666666666667 344.5333333333333 274.5333333333333 295.4666666666667 274.5333333333333 295.4666666666667 225.4666666666667"/>
<polygon id="CENTERS-l2-o2" class="sticker" style="fill: #00ff00" points="344.5333333333333 225.4666666666667 344.5333333333333 274.5333333333333 295.4666666666667 274.5333333333333 295.4666666666667 225.4666666666667"/>
<polygon id="CENTERS-l2-o3" class="sticker" style="fill: #00ff00" points="344.5333333333333 225.4666666666667 344.5333333333333 274.5333333333333 295.4666666666667 274.5333333333333 295.4666666666667 225.4666666666667"/>
<polygon id="EDGES-l9-o0" class="sticker" style="fill: #00ff00" points="295.4666666666667 225.4666666666667 295.4666666666667 274.5333333333333 246.39999999999998 274.5333333333333 246.39999999999998 225.4666666666667"/>
<polygon id="CORNERS-l5-o2" class="sticker" style="fill: #00ff00" points="246.39999999999998 323.6 246.39999999999998 274.5333333333333 295.4666666666667 274.5333333333333 295.4666666666667 323.6"/>
<polygon id="CORNERS-l3-o1" class="sticker" style="fill: #00ff00" points="246.39999999999998 176.39999999999998 295.4666666666667 176.39999999999998 295.4666666666667 225.4666666666667 246.39999999999998 225.4666666666667"/>
<polygon id="EDGES-l0-o1" class="sticker" style="fill: #00ff00" points="344.5333333333333 225.4666666666667 295.4666666666667 225.4666666666667 295.4666666666667 176.39999999999998 344.5333333333333 176.39999999999998"/>
<polygon id="CORNERS-l0-o2" class="sticker" style="fill: #00ff00" points="393.6 176.39999999999998 393.6 225.4666666666667 344.5333333333333 225.4666666666667 344.5333333333333 176.39999999999998"/>
</g><g><title>D</title>
<polygon id="CORNERS-l7-o0" class="sticker" style="fill: #ffff00" points="393.59999999999997 483.6 344.5333333333333 483.6 344.5333333333333 434.5333333333333 393.59999999999997 434.5333333333333"/>
<polygon id="EDGES-l5-o0" class="sticker" style="fill: #ffff00" points="344.5333333333333 434.5333333333333 344.5333333333333 385.4666666666667 393.59999999999997 385.4666666666667 393.59999999999997 434.5333333333333"/>
<polygon id="EDGES-l6-o0" class="sticker" style="fill: #ffff00" points="295.4666666666667 434.5333333333333 344.5333333333333 434.5333333333333 344.5333333333333 483.6 295.4666666666667 483.6"/>
<polygon id="CENTERS-l5-o0" class="sticker" style="fill: #ffff00" points="344.5333333333333 385.4666666666667 344.5333333333333 434.5333333333333 295.4666666666667 434.5333333333333 295.4666666666667 385.4666666666667"/>
<polygon id="CENTERS-l5-o1" class="sticker" style="fill: #ffff00" points="344.5333333333333 385.4666666666667 344.5333333333333 434.5333333333333 295.4666666666667 434.5333333333333 295.4666666666667 385.4666666666667"/>
<polygon id="CENTERS-l5-o2" class="sticker" style="fill: #ffff00" points="344.5333333333333 385.4666666666667 344.5333333333333 434.5333333333333 295.4666666666667 434.5333333333333 295.4666666666667 385.4666666666667"/>
<polygon id="CENTERS-l5-o3" class="sticker" style="fill: #ffff00" points="344.5333333333333 385.4666666666667 344.5333333333333 434.5333333333333 295.4666666666667 434.5333333333333 295.4666666666667 385.4666666666667"/>
<polygon id="EDGES-l7-o0" class="sticker" style="fill: #ffff00" points="295.4666666666667 385.4666666666667 295.4666666666667 434.5333333333333 246.39999999999998 434.5333333333333 246.39999999999998 385.4666666666667"/>
<polygon id="CORNERS-l6-o0" class="sticker" style="fill: #ffff00" points="246.39999999999998 483.6 246.39999999999998 434.5333333333333 295.4666666666667 434.5333333333333 295.4666666666667 483.6"/>
<polygon id="CORNERS-l5-o0" class="sticker" style="fill: #ffff00" points="246.39999999999998 336.4 295.4666666666667 336.4 295.4666666666667 385.4666666666667 246.39999999999998 385.4666666666667"/>
<polygon id="EDGES-l4-o0" class="sticker" style="fill: #ffff00" points="344.5333333333333 385.4666666666667 295.4666666666667 385.4666666666667 295.4666666666667 336.4 344.5333333333333 336.4"/>
<polygon id="CORNERS-l4-o0" class="sticker" style="fill: #ffff00" points="393.6 336.4 393.6 385.4666666666667 344.5333333333333 385.4666666666667 344.5333333333333 336.4"/>
</g><g><title>L</title>
<polygon id="CORNERS-l6-o2" class="sticker" style="fill: #ff8000" points="86.40000000000005 323.6 86.40000000000006 274.5333333333333 135.46666666666675 274.5333333333333 135.46666666666675 323.6"/>
<polygon id="EDGES-l7-o1" class="sticker" style="fill: #ff8000" points="135.46666666666675 274.5333333333333 184.53333333333336 274.5333333333333 184.53333333333336 323.6 135.46666666666675 323.6"/>
<polygon id="EDGES-l11-o1" class="sticker" style="fill: #ff8000" points="135.46666666666675 225.4666666666667 135.46666666666675 274.5333333333333 86.40000000000008 274.5333333333333 86.40000000000008 225.4666666666667"/>
<polygon id="CENTERS-l1-o0" class="sticker" style="fill: #ff8000" points="184.53333333333336 225.4666666666667 184.53333333333336 274.5333333333333 135.46666666666675 274.5333333333333 135.46666666666675 225.4666666666667"/>
<polygon id="CENTERS-l1-o1" class="sticker" style="fill: #ff8000" points="184.53333333333336 225.4666666666667 184.53333333333336 274.5333333333333 135.46666666666675 274.5333333333333 135.46666666666675 225.4666666666667"/>
<polygon id="CENTERS-l1-o2" class="sticker" style="fill: #ff8000" points="184.53333333333336 225.4666666666667 184.53333333333336 274.5333333333333 135.46666666666675 274.5333333333333 135.46666666666675 225.4666666666667"/>
<polygon id="CENTERS-l1-o3" class="sticker" style="fill: #ff8000" points="184.53333333333336 225.4666666666667 184.53333333333336 274.5333333333333 135.46666666666675 274.5333333333333 135.46666666666675 225.4666666666667"/>
<polygon id="EDGES-l3-o1" class="sticker" style="fill: #ff8000" points="184.53333333333336 225.4666666666667 135.46666666666675 225.4666666666667 135.46666666666675 176.39999999999998 184.53333333333336 176.39999999999998"/>
<polygon id="CORNERS-l2-o1" class="sticker" style="fill: #ff8000" points="86.40000000000008 176.39999999999998 135.46666666666675 176.39999999999998 135.46666666666675 225.4666666666667 86.40000000000008 225.4666666666667"/>
<polygon id="CORNERS-l3-o2" class="sticker" style="fill: #ff8000" points="233.6000000000001 176.39999999999998 233.60000000000008 225.4666666666667 184.53333333333336 225.4666666666667 184.53333333333336 176.39999999999998"/>
<polygon id="EDGES-l9-o1" class="sticker" style="fill: #ff8000" points="184.53333333333336 274.5333333333333 184.53333333333336 225.4666666666667 233.60000000000008 225.4666666666667 233.60000000000008 274.5333333333333"/>
<polygon id="CORNERS-l5-o1" class="sticker" style="fill: #ff8000" points="233.60000000000005 323.6 184.53333333333336 323.6 184.53333333333336 274.5333333333333 233.60000000000008 274.5333333333333"/>
</g><g><title>B</title>
<polygon id="CORNERS-l1-o1" class="sticker" style="fill: #0000ff" points="566.4 176.4 615.4666666666667 176.4 615.4666666666667 225.46666666666673 566.4 225.46666666666673"/>
<polygon id="EDGES-l10-o0" class="sticker" style="fill: #0000ff" points="615.4666666666667 225.46666666666673 615.4666666666667 274.5333333333333 566.4 274.5333333333333 566.4 225.46666666666673"/>
<polygon id="EDGES-l2-o1" class="sticker" style="fill: #0000ff" points="664.5333333333333 225.46666666666673 615.4666666666667 225.46666666666673 615.4666666666667 176.40000000000006 664.5333333333333 176.40000000000006"/>
<polygon id="CENTERS-l4-o0" class="sticker" style="fill: #0000ff" points="664.5333333333333 225.46666666666673 664.5333333333333 274.5333333333333 615.4666666666667 274.5333333333333 615.4666666666667 225.46666666666673"/>
<polygon id="CENTERS-l4-o1" class="sticker" style="fill: #0000ff" points="664.5333333333333 225.46666666666673 664.5333333333333 274.5333333333333 615.4666666666667 274.5333333333333 615.4666666666667 225.46666666666673"/>
<polygon id="CENTERS-l4-o2" class="sticker" style="fill: #0000ff" points="664.5333333333333 225.46666666666673 664.5333333333333 274.5333333333333 615.4666666666667 274.5333333333333 615.4666666666667 225.46666666666673"/>
<polygon id="CENTERS-l4-o3" class="sticker" style="fill: #0000ff" points="664.5333333333333 225.46666666666673 664.5333333333333 274.5333333333333 615.4666666666667 274.5333333333333 615.4666666666667 225.46666666666673"/>
<polygon id="EDGES-l11-o0" class="sticker" style="fill: #0000ff" points="664.5333333333333 274.5333333333333 664.5333333333333 225.46666666666673 713.6 225.46666666666673 713.6 274.5333333333333"/>
<polygon id="CORNERS-l2-o2" class="sticker" style="fill: #0000ff" points="713.6 176.40000000000006 713.6 225.46666666666673 664.5333333333333 225.46666666666673 664.5333333333333 176.40000000000006"/>
<polygon id="CORNERS-l6-o1" class="sticker" style="fill: #0000ff" points="713.6 323.6 664.5333333333333 323.6 664.5333333333333 274.5333333333333 713.6 274.5333333333333"/>
<polygon id="EDGES-l6-o1" class="sticker" style="fill: #0000ff" points="615.4666666666667 274.5333333333333 664.5333333333333 274.5333333333333 664.5333333333333 323.6 615.4666666666667 323.6"/>
<polygon id="CORNERS-l7-o2" class="sticker" style="fill: #0000ff" points="566.4 323.6 566.4 274.5333333333333 615.4666666666667 274.5333333333333 615.4666666666667 323.6"/>
</g><g><title>U</title>
<polygon id="CORNERS-l2-o0" class="sticker" style="fill: #ffffff" points="246.40000000000003 16.40000000000009 295.4666666666667 16.40000000000009 295.4666666666667 65.46666666666681 246.40000000000003 65.46666666666681"/>
<polygon id="EDGES-l3-o0" class="sticker" style="fill: #ffffff" points="295.4666666666667 65.46666666666681 295.4666666666667 114.53333333333342 246.40000000000003 114.53333333333342 246.40000000000003 65.46666666666681"/>
<polygon id="EDGES-l2-o0" class="sticker" style="fill: #ffffff" points="344.5333333333333 65.46666666666681 295.4666666666667 65.46666666666681 295.4666666666667 16.400000000000148 344.5333333333333 16.40000000000009"/>
<polygon id="CENTERS-l0-o0" class="sticker" style="fill: #ffffff" points="344.5333333333333 65.46666666666681 344.5333333333333 114.53333333333342 295.4666666666667 114.53333333333342 295.4666666666667 65.46666666666681"/>
<polygon id="CENTERS-l0-o1" class="sticker" style="fill: #ffffff" points="344.5333333333333 65.46666666666681 344.5333333333333 114.53333333333342 295.4666666666667 114.53333333333342 295.4666666666667 65.46666666666681"/>
<polygon id="CENTERS-l0-o2" class="sticker" style="fill: #ffffff" points="344.5333333333333 65.46666666666681 344.5333333333333 114.53333333333342 295.4666666666667 114.53333333333342 295.4666666666667 65.46666666666681"/>
<polygon id="CENTERS-l0-o3" class="sticker" style="fill: #ffffff" points="344.5333333333333 65.46666666666681 344.5333333333333 114.53333333333342 295.4666666666667 114.53333333333342 295.4666666666667 65.46666666666681"/>
<polygon id="EDGES-l1-o0" class="sticker" style="fill: #ffffff" points="344.5333333333333 114.53333333333342 344.5333333333333 65.46666666666681 393.6 65.46666666666681 393.6 114.53333333333342"/>
<polygon id="CORNERS-l1-o0" class="sticker" style="fill: #ffffff" points="393.6 16.40000000000009 393.6 65.46666666666681 344.5333333333333 65.46666666666681 344.5333333333333 16.40000000000009"/>
<polygon id="CORNERS-l0-o0" class="sticker" style="fill: #ffffff" points="393.6 163.60000000000014 344.5333333333333 163.60000000000014 344.5333333333333 114.53333333333342 393.6 114.53333333333342"/>
<polygon id="EDGES-l0-o0" class="sticker" style="fill: #ffffff" points="295.4666666666667 114.53333333333342 344.5333333333333 114.53333333333342 344.5333333333333 163.60000000000014 295.4666666666667 163.60000000000014"/>
<polygon id="CORNERS-l3-o0" class="sticker" style="fill: #ffffff" points="246.39999999999998 163.60000000000014 246.39999999999998 114.53333333333342 295.4666666666667 114.53333333333342 295.4666666666667 163.60000000000014"/>
</g><g><title>R</title>
<polygon id="CORNERS-l1-o2" class="sticker" style="fill: #ff0000" points="553.6 176.40000000000003 553.6 225.4666666666667 504.5333333333333 225.4666666666667 504.5333333333333 176.40000000000003"/>
<polygon id="EDGES-l1-o1" class="sticker" style="fill: #ff0000" points="504.5333333333333 225.4666666666667 455.4666666666667 225.4666666666667 455.4666666666667 176.40000000000003 504.5333333333333 176.40000000000003"/>
<polygon id="EDGES-l10-o1" class="sticker" style="fill: #ff0000" points="504.5333333333333 274.5333333333333 504.5333333333333 225.4666666666667 553.6 225.4666666666667 553.6 274.5333333333333"/>
<polygon id="CENTERS-l3-o0" class="sticker" style="fill: #ff0000" points="504.5333333333333 225.4666666666667 504.5333333333333 274.5333333333333 455.4666666666667 274.5333333333333 455.4666666666667 225.4666666666667"/>
<polygon id="CENTERS-l3-o1" class="sticker" style="fill: #ff0000" points="504.5333333333333 225.4666666666667 504.5333333333333 274.5333333333333 455.4666666666667 274.5333333333333 455.4666666666667 225.4666666666667"/>
<polygon id="CENTERS-l3-o2" class="sticker" style="fill: #ff0000" points="504.5333333333333 225.4666666666667 504.5333333333333 274.5333333333333 455.4666666666667 274.5333333333333 455.4666666666667 225.4666666666667"/>
<polygon id="CENTERS-l3-o3" class="sticker" style="fill: #ff0000" points="504.5333333333333 225.4666666666667 504.5333333333333 274.5333333333333 455.4666666666667 274.5333333333333 455.4666666666667 225.4666666666667"/>
<polygon id="EDGES-l5-o1" class="sticker" style="fill: #ff0000" points="455.4666666666667 274.5333333333333 504.5333333333333 274.5333333333333 504.5333333333333 323.6 455.4666666666667 323.6"/>
<polygon id="CORNERS-l7-o1" class="sticker" style="fill: #ff0000" points="553.6 323.6 504.5333333333333 323.6 504.5333333333333 274.5333333333333 553.6 274.5333333333333"/>
<polygon id="CORNERS-l4-o2" class="sticker" style="fill: #ff0000" points="406.4 323.6 406.4 274.5333333333333 455.4666666666667 274.5333333333333 455.4666666666667 323.6"/>
<polygon id="EDGES-l8-o1" class="sticker" style="fill: #ff0000" points="455.4666666666667 225.4666666666667 455.4666666666667 274.5333333333333 406.4 274.5333333333333 406.4 225.4666666666667"/>
<polygon id="CORNERS-l0-o1" class="sticker" style="fill: #ff0000" points="406.4 176.39999999999998 455.4666666666667 176.39999999999998 455.4666666666667 225.4666666666667 406.4 225.4666666666667"/>
</g></svg>
`;

const reorder = function (arr, index) {
  const start = arr.slice(index);
  const end = arr.slice(0, index);
  return start.concat(end);
};

const getFaceletByOrientation = (piece, orientation) => piece[orientation];

let SWAP = 0,
  TWIST = 1,
  IGNORE_POS = 2,
  IGNORE_ORI = 3;
let mode = SWAP;

function Cube() {
  this.selectedFacelet = null;

  this.getPieceByFacelet = ({position, type}) => this[type][position];

  this.swapFacelets = function (facelet1, facelet2) {
    const facelet1Elem = document.getElementById(facelet1.id);
    const facelet2Elem = document.getElementById(facelet2.id);

    const temp = facelet1Elem.style.fill;
    facelet1Elem.style.fill = facelet2Elem.style.fill;
    facelet2Elem.style.fill = temp;
  };

  this.twist = function (facelet) {
    const piece = this.getPieceByFacelet(facelet);

    const numSides = Object.values(piece).length;

    for (let i = 0; i < (numSides - 1); i++) {
      const facelet = getFaceletByOrientation(piece, i);
      const facelet2Orientation = (numSides + facelet.orientation + 1) % numSides;
      this.swapFacelets(facelet, getFaceletByOrientation(piece, facelet2Orientation));
    }
  };

  this.swap = function (facelet1, facelet2) {
    const piece1 = this.getPieceByFacelet(facelet1);
    const piece2 = this.getPieceByFacelet(facelet2);

    if (piece1 === piece2) {
      return;
    }

    const offset = facelet2.orientation - facelet1.orientation;
   
    const numSides = Object.values(piece1).length;

    for (let i = 0; i < (numSides); i++) {
      const facelet = getFaceletByOrientation(piece1, i);

      const facelet2Orientation = (numSides + facelet.orientation + offset) % numSides;
      this.swapFacelets(facelet, getFaceletByOrientation(piece2, facelet2Orientation));
    }
  };
}

const cube = new Cube();

function Facelet(id, type, position, orientation) {
  this.id = id;
  this.type = type;
  this.orientation = parseInt(orientation);
  this.position = parseInt(position);

  this.deselect = function () {
    cube.selectedFacelet = null;
    document.getElementById(id).style.opacity = null;
  };

  this.select = function () {
    if (cube.selectedFacelet) {
      cube.selectedFacelet.deselect();
    }

    cube.selectedFacelet = this;
    document.getElementById(id).style.opacity = 0.7;
  };

  this.click = function () {
    switch (mode) {
      case SWAP:
        if (cube.selectedFacelet && cube.selectedFacelet.type == this.type) {
          cube.swap(cube.selectedFacelet, this);

          cube.selectedFacelet.deselect();
        } else {
          this.select();
        }
        break;
      case TWIST:
        cube.twist(this);
        break;
      default:
        break;
    }
  };
}

const setPuzzleContents = (content) => {
  document.getElementById('puzzle').innerHTML = content;
}

const displayCube = () => {
  const puzzle = document.querySelector('svg');
  const facelets = puzzle.querySelectorAll('polygon');
  facelets.forEach((element) => {
    const [type, position, orientation] = element.id.split("-");
    
    // Strip prefixes from orientation and position
    const facelet = new Facelet(element.id, type, position.substring(1), orientation.substring(1));
    if (!cube[type]) {
      cube[type] = {};
    }
    cube[type][position] = {
      ...cube[type][position],
      [orientation]: facelet,
    };
    element.onclick = () => facelet.click();
  });
};

const updateCube = () => {
  const svg = document.getElementById('svgInput').value;
  setPuzzleContents(svg);

  displayCube();
}

const initCube = () => {
  setPuzzleContents(SVG);
  displayCube();
}

